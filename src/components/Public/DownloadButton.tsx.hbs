import React, { useState } from "react";
import { Button } from "../ui/button";
import { Download } from "lucide-react";
import toast from "react-hot-toast";
import { cn } from "@/lib/utils";

const DownloadButton: React.FC<{
  api: any;
  name: string;
  template?: boolean;
  className?: string;
}> = ({ api, name, template = false, className }) => {
  const [isLoading, setIsLoading] = useState(false);
  const onDownload = async () => {
    setIsLoading(true);
    const response = await api();

    if (response.status === 200) {
      // Create a Blob from the raw data response
      const blob = new Blob([response.data], {
        type: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
      });

      // Create a link element to trigger the download
      const url = window.URL.createObjectURL(blob);
      const link = document.createElement("a");
      link.href = url;
      link.setAttribute("download", name); // Set the file name
      document.body.appendChild(link);
      link.click();

      // Cleanup the link element
      document.body.removeChild(link);
      toast.success("Berhasil download file");
    } else {
      console.error("Failed to download file:", response);
      toast.error("Gagal download file");
    }
    setIsLoading(false);
  };
  return (
    <Button
      type="button"
      onClick={onDownload}
      variant={"outline"}
      size={"md"}
      className={cn("aspect-square h-12 w-12 p-0", className)}
      loading={isLoading}
      disabled={isLoading}
    >
      <Download className="h-5 w-5" strokeWidth={1.3} /> 
      {template ? "Download Template" : ""}
    </Button>
  );
};

export default DownloadButton;
